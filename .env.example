# Crown Service Configuration

# === Compute Mode ===
# local: Prioritizes MPS/MLX for M4 Pro Mac mini
# cloud: Prioritizes CUDA for cloud GPUs  
COMPUTE_MODE=local

# === Service Configuration ===
SERVICE_NAME=crown-template
ENVIRONMENT=development

# === API Configuration ===
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=1

# === Database ===
DATABASE_URL=postgresql+asyncpg://crown:crown@localhost:5432/crown_dev
POSTGRES_USER=crown
POSTGRES_PASSWORD=crown
POSTGRES_DB=crown_dev

# === Redis ===
REDIS_URL=redis://localhost:6379/0

# === Storage (Local Development) ===
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=crown-artifacts
MINIO_SECURE=false

# === Storage (Cloud/Production) ===
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_DEFAULT_REGION=us-east-1
# S3_BUCKET=crown-artifacts

# === MPS Optimization (M4 Pro) ===
# Enable fallback for unsupported MPS operations
PYTORCH_ENABLE_MPS_FALLBACK=1
# Memory management for MPS
PYTORCH_MPS_HIGH_WATERMARK_RATIO=0.95
PYTORCH_MPS_LOW_WATERMARK_RATIO=0.90
# Disable tokenizer parallelism to avoid warnings
TOKENIZERS_PARALLELISM=false
# Set MPS as default device
SET_DEFAULT_DEVICE=true

# === Training Configuration ===
MIXED_PRECISION=fp16_mps  # no, fp16, bf16, fp16_mps
GRADIENT_ACCUMULATION_STEPS=1
GRADIENT_CHECKPOINTING=false
DATALOADER_NUM_WORKERS=-1  # Auto-detect (cpu_count - 1)
SEED=621

# === Device Configuration ===
DEVICE=auto  # auto, cuda, mps, cpu
CUDA_VISIBLE_DEVICES=0
MPS_FALLBACK=true
MPS_HIGH_WATERMARK=0.95
MPS_LOW_WATERMARK=0.90

# === Model Configuration ===
MODEL_NAME=mistralai/Mistral-7B-v0.1
MODEL_CACHE_DIR=./models

# === Weights & Biases ===
WANDB_PROJECT=crown-experiments
WANDB_ENTITY=your-entity
WANDB_MODE=offline  # offline, online, disabled

# === Logging ===
LOG_LEVEL=INFO
LOG_FORMAT=json  # json or console

# === Observability ===
# SENTRY_DSN=
ENABLE_METRICS=true
ENABLE_TRACING=false